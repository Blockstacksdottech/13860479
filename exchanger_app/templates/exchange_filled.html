{% extends "footer.html" %}
{% block content %}
<section class="exchange">
	<div class="container">
		<!-- Grid row -->
		<div class="row">

			<!-- Grid column -->
			<div class="col-md-12 col-lg-12 col-xl-12">

				<ul class="nav md-pills nav-justified ">
					<li class="nav-item">
						<a class="nav-link pill-inactive" data-toggle="tab" role="tab">
				Select Coins <img class="img-fluid" width="30" height="30" src="/assets/img/loading.gif" alt="">
			</a>
					</li>
					<li class="nav-item">
						<a class="nav-link pill-active" data-toggle="tab" role="tab">
				Transaction Info <img class="img-fluid" width="30" height="30" src="/assets/img/loading.gif" alt="">
			</a>
					</li>
					<li class="nav-item">
						<a class="nav-link pill-inactive" data-toggle="tab" role="tab">
				Awaiting Deposit <img class="img-fluid" width="30" height="30" src="/assets/img/loading.gif" alt="">
			</a>
					</li>
					<li class="nav-item">
						<a class="nav-link pill-inactive" data-toggle="tab" role="tab">
				Exchanging <img class="img-fluid" width="30" height="30" src="/assets/img/loading.gif" alt="">
			</a>
					</li>
					<li class="nav-item">
						<a class="nav-link pill-inactive" data-toggle="tab" role="tab">
				Finish <img class="img-fluid" width="30" height="30" src="/assets/img/loading.gif" alt="">
			</a>
					</li>
				</ul>

				<!-- Tab panels -->
				<div class="tab-content">

					<!--Panel 1-->
					{% csrf_token %}
					<div class="tab-pane fade in show active" role="tabpanel">

						<div class="row my-5  col-10 mx-auto ">
							<div class="col-md-4">
								<label>You send</label>
								<input type="text" class="form-control mb-4" id =  'income' value="Bitcoin">

								<label>You receive</label>
								<input type="text" class="form-control mb-4"  id='outgo' value="Monero">
							</div>
							<div class="col-md-8">

								<label>
									Backup Wallet  
										<a class="fa fa-question-circle" data-toggle="tooltip" data-placement="right" title="the address wallet to refund if something went wrong." ></a>
								</label>
								<input type="text" class="form-control mb-4" id='r_wallet'>

								<label>
									Receiving Wallet
									<a href="#" data-toggle="tooltip" title="The wallet address where you want your exchanged coin to arrive.">
											<i class="far fa-question-circle"></i>
										</a>
								</label>
								<input type="text" class="form-control mb-4" id='b_wallet'>

								<div class=" mb-4">
									<input type="checkbox" id="inputTerms" name="terms">
									<label>
									I agree to the terms and conditions
								</label>
								</div>

								<button class="btn btn-success my-2" type="submit" id="target">Start Exchange</button>
								<a href = "/exchange"><button class="btn btn-light my-2" type="submit">Go Back</button></a>
								<div class="errormessage2"></div>

							</div>
						</div>

					</div>
					<!--/.Panel 1-->

				</div>

			</div>
			<!-- Grid column -->

		</div>
		<!-- Grid row -->
	</div>
</section>

{% endblock %}
{% block script %}
<script type="text/javascript">
	var token = jQuery("[name=csrfmiddlewaretoken]").val();
	console.log(token);
	
	$(document).ready(function() {
		var inc = '{{cur_in}}' ;
		var outc = '{{cur_out}}' ;
		var apilink = '{{api_link}}' ;
		$('#income').val(inc).change();
		$('#outgo').val(outc).change();
	});
	$("#target").click(function() {
		var inCurrency = $('#income').val();
		var outCurrency = $('#outgo').val();
		var returnAddress = $('#r_wallet').val();
		var refundAddress = $('#b_wallet').val();
		if ($('input[name="terms"]').is(":checked")) {
			if (returnAddress != '' && refundAddress != '') {
				$.ajaxSetup({
				headers: {
					'X-CSRFToken':token
				}
			});
				alert({
						inCurrency: inCurrency,
						outCurrency: outCurrency,
						refundAddress: refundAddress,
						returnAddress: returnAddress
					});
				$.post("{{api_link}}", {
						inCurrency: inCurrency,
						outCurrency: outCurrency,
						refundAddress: refundAddress,
						returnAddress: returnAddress
					})
					.done(function(data) {
						
						var data = JSON.parse(data)
						window.location.href = "/details/" + data.processId;
					})
					.fail(function(xhr, textStatus, errorThrown) {
						$('.errormessage2').text('The API rejected this Addresses!')
					})
			} else {
				$('.errormessage2').text('Please fill the forms.')
			}
		} else {
			$('.errormessage2').text('Please check the terms of conditions.')
		}
	});
</script>
{% endblock %}